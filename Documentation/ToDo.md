# 2D 플랫포머 이동 시스템 작업 목록

## 벽 관련 이동 기능

### 벽 매달리기 (Wall Hang)
- [ ] 벽 감지 시스템 구현
  - 좌우 벽 감지를 위한 Raycast 또는 Collider 기반 감지
  - 벽 감지 상태(`IsOnWall`) 프로퍼티 추가
- [ ] 벽 매달리기 상태 구현
  - 벽에 닿았을 때 자동으로 매달리기 상태 진입
  - 매달리기 중 중력 적용 중지 또는 감소
  - 매달리기 지속 시간 제한 (스태미나 또는 시간 기반)
- [ ] 매달리기 중 입력 처리
  - 위/아래 키 입력으로 벽을 따라 이동
  - 점프 키 입력으로 벽 점프 가능
  - 매달리기 해제 조건 (키 입력 또는 시간 초과)

### 벽 점프 (Wall Jump)
- [ ] 벽 점프 입력 감지
  - 벽에 매달린 상태에서 점프 키 입력 감지
  - 벽 점프 방향 결정 (벽에서 멀어지는 방향)
- [ ] 벽 점프 물리 구현
  - 벽에서 멀어지는 수평 속도 적용
  - 수직 점프 속도 적용
  - 벽 점프 후 일시적으로 벽 감지 무시
- [ ] 벽 점프 제한 설정
  - 벽 점프 횟수 제한 (기본값: 1회, 기능 해금 시 증가 가능)
  - 벽 점프 쿨타임 또는 스태미나 소모

### 벽 미끄러지기 (Wall Slide)
- [ ] 벽 미끄러지기 상태 구현
  - 벽에 닿고 아래 방향 입력 시 미끄러지기 상태 진입
  - 미끄러지기 중 낙하 속도 제한 (일정 속도로 감소)
  - 미끄러지기 중 중력 적용 조정
- [ ] 미끄러지기 중 입력 처리
  - 미끄러지기 중 점프 키로 벽 점프 가능
  - 미끄러지기 중 위 방향 입력으로 벽 오르기 가능 (난간 오르기와 연동)
- [ ] 미끄러지기 피드백
  - 미끄러지기 애니메이션
  - 미끄러지기 사운드 효과

## 난간 관련 이동 기능

### 난간 매달리기 (Ledge Hang)
- [ ] 난간 감지 시스템 구현
  - 플랫폼 가장자리 감지 (Raycast 기반)
  - 난간 위치 계산 및 매달리기 위치 결정
- [ ] 난간 매달리기 상태 구현
  - 난간에 도달 시 자동으로 매달리기 상태 진입
  - 매달리기 중 중력 적용 중지
  - 매달리기 위치로 플레이어 이동 및 고정
- [ ] 매달리기 중 입력 처리
  - 위 방향 키 입력으로 난간 오르기
  - 아래 방향 키 입력으로 매달리기 해제
  - 좌우 방향 키 입력으로 난간 이동 (선택 사항)

### 난간 오르기 (Ledge Climb)
- [ ] 난간 오르기 입력 감지
  - 난간에 매달린 상태에서 위 방향 키 입력 감지
- [ ] 난간 오르기 애니메이션 및 이동
  - 오르기 애니메이션 재생
  - 플랫폼 위로 이동하는 경로 계산
  - 오르기 완료 후 플랫폼 위 위치로 이동
- [ ] 난간 오르기 제한 설정
  - 오르기 시간 또는 스태미나 소모
  - 오르기 중 무적 시간 (선택 사항)

## 사다리 기능

### 사다리 감지 및 진입
- [ ] 사다리 감지 시스템 구현
  - 사다리 오브젝트 감지 (Trigger Collider 기반)
  - 사다리 진입 영역 감지
- [ ] 사다리 진입 처리
  - 사다리 영역 진입 시 자동으로 사다리 모드 진입
  - 사다리 모드 진입 시 중력 적용 중지
  - 사다리 모드 진입 시 수평 이동 제한 (선택 사항)

### 사다리 이동
- [ ] 사다리 위/아래 이동
  - 위/아래 방향 키 입력으로 사다리 이동
  - 사다리 이동 속도 설정
  - 사다리 끝에 도달 시 자동으로 사다리 모드 해제
- [ ] 사다리 중 점프 처리
  - 사다리 중 점프 키 입력 시 사다리 모드 해제 및 점프
  - 사다리에서 점프 시 수평 이동 가능
- [ ] 사다리 중 좌우 이동 (선택 사항)
  - 사다리 중 좌우 키 입력으로 사다리에서 이탈
  - 이탈 시 사다리 모드 해제 및 일반 이동 모드로 전환

## 공통 구현 사항

### 상태 관리
- [ ] 이동 상태 머신 구현 또는 확장
  - 기존 이동 상태에 벽 매달리기, 난간 매달리기, 사다리 모드 추가
  - 상태 전환 로직 구현
  - 상태별 물리 설정 관리

### 물리 설정
- [ ] 각 상태별 Rigidbody2D 설정
  - 벽 매달리기: 중력 스케일 0 또는 감소
  - 난간 매달리기: 중력 스케일 0
  - 사다리 모드: 중력 스케일 0, 수평 이동 제한

### 입력 처리
- [ ] PlayerController에 새로운 입력 처리 추가
  - 벽 점프 입력 감지
  - 난간 오르기 입력 감지
  - 사다리 이동 입력 처리

### PlayerPhysics API 확장
- [ ] 벽 관련 API
  - `bool IsOnWall { get; }` - 벽 감지 상태
  - `bool IsWallSliding { get; }` - 벽 미끄러지기 상태
  - `void RequestWallJump()` - 벽 점프 요청
- [ ] 난간 관련 API
  - `bool IsLedgeHanging { get; }` - 난간 매달리기 상태
  - `void RequestLedgeClimb()` - 난간 오르기 요청
- [ ] 사다리 관련 API
  - `bool IsOnLadder { get; }` - 사다리 모드 상태
  - `void EnterLadderMode()` - 사다리 모드 진입
  - `void ExitLadderMode()` - 사다리 모드 해제
  - `void ApplyLadderMovement(float verticalInput)` - 사다리 이동 적용

### 디버깅 도구
- [ ] 벽 감지 시각화
  - 벽 감지 Raycast 시각화 (에디터 전용)
- [ ] 난간 감지 시각화
  - 난간 감지 영역 시각화 (에디터 전용)
- [ ] 사다리 영역 시각화
  - 사다리 Trigger 영역 시각화 (에디터 전용)

## 리팩토링 작업

### 이동 상태 머신 (Movement State Machine)
- [ ] 이동 상태 열거형 정의
  - `Idle` - 정지 상태
  - `Walk` - 걷기 상태
  - `Dash` - 대시 상태
  - `Falling` - 낙하 상태
  - `Jumping` - 점프 상태
  - `WallHang` - 벽 매달리기 상태
  - `WallSlide` - 벽 미끄러지기 상태
  - `LedgeHang` - 난간 매달리기 상태
  - `Ladder` - 사다리 상태
- [ ] 상태 머신 클래스 설계
  - 상태 전환 로직 관리
  - 상태별 Enter/Update/Exit 메서드 지원
  - 현재 상태 프로퍼티 (`CurrentState`)
  - 상태 변경 이벤트 (선택 사항)
- [ ] 상태 머신 통합
  - `PlayerController` 또는 `PlayerPhysics`에 상태 머신 통합
  - 기존 이동 로직을 상태 기반으로 리팩토링

### 상태 머신 갱신 로직
- [ ] 상태 전환 조건 정의
  - **기본 이동 상태 전환**
    - `Idle` → `Walk`: 수평 입력이 있고 바닥에 있을 때
    - `Walk` → `Idle`: 수평 입력이 없고 바닥에 있을 때
    - `Idle`/`Walk` → `Jumping`: 점프 입력 시
    - `Jumping` → `Falling`: 상승 속도가 0 이하일 때
    - `Falling` → `Idle`/`Walk`: 바닥에 착지했을 때
    - `Idle`/`Walk` → `Dash`: 대시 입력 시
    - `Dash` → `Idle`/`Walk`/`Falling`: 대시 완료 후
  - **벽 관련 상태 전환**
    - `Falling`/`Jumping` → `WallHang`: 벽에 닿았을 때 (벽 매달리기 조건 만족)
    - `WallHang` → `WallSlide`: 벽에 닿고 아래 방향 입력 시
    - `WallHang`/`WallSlide` → `Jumping`: 벽 점프 입력 시
    - `WallHang`/`WallSlide` → `Falling`: 벽에서 이탈했을 때
    - `WallHang`/`WallSlide` → `LedgeHang`: 난간 감지 시 (선택 사항)
  - **난간 관련 상태 전환**
    - `Falling`/`Jumping` → `LedgeHang`: 난간 감지 시
    - `LedgeHang` → `Idle`/`Walk`: 난간 오르기 완료 후
    - `LedgeHang` → `Falling`: 아래 방향 입력 또는 매달리기 해제 시
  - **사다리 관련 상태 전환**
    - `Idle`/`Walk`/`Falling`/`Jumping` → `Ladder`: 사다리 영역 진입 시
    - `Ladder` → `Idle`/`Walk`/`Falling`: 사다리 영역 이탈 시
    - `Ladder` → `Jumping`: 사다리 중 점프 입력 시
- [ ] 상태 갱신 타이밍
  - `Update()` 또는 `FixedUpdate()`에서 상태 갱신
  - 상태 전환은 물리 업데이트 전에 처리
  - 상태별 업데이트 로직 분리
- [ ] 상태별 동작 구현
  - 각 상태의 Enter/Update/Exit 메서드 구현
  - 상태별 물리 설정 적용
  - 상태별 애니메이션 트리거 (향후 확장)

### 상태 머신 구조 설계
- [ ] 상태 인터페이스 또는 추상 클래스
  - `IState` 인터페이스 또는 `StateBase` 추상 클래스
  - `OnEnter()`, `OnUpdate()`, `OnExit()` 메서드 정의
- [ ] 상태 클래스 구현
  - **기본 이동 상태**
    - `IdleState`, `WalkState`, `DashState`, `FallingState`, `JumpingState`
  - **벽 관련 상태**
    - `WallHangState`, `WallSlideState`
  - **난간 관련 상태**
    - `LedgeHangState`
  - **사다리 관련 상태**
    - `LadderState`
  - 각 상태별 고유 로직 캡슐화
- [ ] 상태 전환 관리
  - 상태 전환 조건 검사 로직
  - 상태 전환 시 이전 상태 Exit → 새 상태 Enter 순서 보장
  - 상태 전환 중복 방지 로직

### 기존 코드 리팩토링
- [ ] PlayerController 리팩토링
  - 상태 머신 기반으로 입력 처리 로직 재구성
  - 상태별 입력 처리 분리
- [ ] PlayerPhysics 리팩토링
  - 상태 머신과 연동하여 물리 적용
  - 상태별 물리 설정 관리
  - 상태 전환 시 물리 속도 초기화 또는 유지 로직
- [ ] 코드 구조 개선
  - 상태별 책임 분리
  - 중복 코드 제거
  - 확장성 향상 (새로운 상태 추가 용이)

### 테스트 및 검증
- [ ] 상태 전환 테스트
  - 각 상태 전환이 올바르게 작동하는지 확인
  - 상태 전환 타이밍 검증
- [ ] 기존 기능 유지 확인
  - 리팩토링 후 기존 이동 기능이 정상 작동하는지 확인
  - 점프, 대시, 이동 등 모든 기능 검증
- [ ] 성능 검증
  - 상태 머신 추가로 인한 성능 영향 확인
  - 불필요한 상태 전환 체크 최적화

## 참고 사항

- 기존 이동 시스템과의 통합 고려
  - [PlayerMovement-Design.md](./PlayerMovement-Design.md) 참조
  - [PlayerMovement-Implementation.md](./PlayerMovement-Implementation.md) 참조
- 각 기능은 독립적으로 구현 가능하나, 상태 관리 시스템 통합 필요
- 기능 해금 시스템과 연동 가능하도록 설계 (벽 점프 횟수, 난간 오르기 스태미나 등)
- 상태 머신 리팩토링은 새로운 이동 기능 추가 전에 완료하는 것을 권장

